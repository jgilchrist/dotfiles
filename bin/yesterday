#!/usr/bin/env bash

set -o errexit
set -o pipefail

main() {
    if [ -z "${DAY_LOG_DIR}" ]; then
        echo "DAY_LOG_DIR not defined"
        exit 1
    fi

    if [ -z "${EDITOR}" ]; then
        echo "EDITOR not defined"
        exit 1
    fi

    local dayofweek
    dayofweek=$(date +%w)
    local lookback
    if [ "${dayofweek}" -eq 1 ]; then
        lookback=3
    else
        lookback=1
    fi

    local log_date
    log_date=$(date --date="$lookback day ago" +'%Y-%m-%d')
    local log_file
    log_file="${DAY_LOG_DIR}/${log_date}.md"

    if [ ! -f "${log_file}" ]; then
        echo "no log file: ${log_file}"
        exit 1
    fi

    ${EDITOR} "${log_file}"
}

main "$@"
